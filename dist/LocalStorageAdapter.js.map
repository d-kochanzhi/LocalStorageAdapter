{"version":3,"file":"LocalStorageAdapter.js","sources":["../src/LocalStorageAdapter.js"],"sourcesContent":["/* eslint-disable class-methods-use-this */\r\n/* eslint-disable func-names */\r\n/* eslint-disable no-plusplus */\r\n/* eslint-disable no-param-reassign */\r\n/* eslint-disable no-underscore-dangle */\r\nexport default class LocalStorageJs {\r\n  constructor(options = {}) {\r\n    if (!window.localStorage) throw new Error('No window.localStorage Defined');\r\n\r\n    this.options = {\r\n      prefix: 'pre_',\r\n      ...options,\r\n    };\r\n\r\n    this.storage = window.localStorage;\r\n  }\r\n\r\n  _prepareValue(value) {\r\n    return {\r\n      stamp: Date.now(),\r\n      value,\r\n    };\r\n  }\r\n\r\n  _prepareKey(key) {\r\n    return this.options.prefix + key;\r\n  }\r\n\r\n  _get(key) {\r\n    return JSON.parse(this.storage.getItem(this._prepareKey(key)));\r\n  }\r\n\r\n  get(key) {\r\n    const value = this._get(key);\r\n    if (value) return value.value;\r\n    return null;\r\n  }\r\n\r\n  set(key, value) {\r\n    if (!value) this.storage.removeItem(key);\r\n\r\n    this.storage.setItem(this._prepareKey(key), JSON.stringify(this._prepareValue(value)));\r\n    return value;\r\n  }\r\n\r\n  clear() {\r\n    for (let i = 0; i < this.storage.length; i++) {\r\n      const key = this.storage.key(i);\r\n      if (key.startsWith(this.options.prefix)) this.storage.removeItem(key);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get cached value\r\n   * @param {string} key key string\r\n   * @param {integer} maxage in milliseconds\r\n   * @param {function} callback function\r\n   * @returns {object} value\r\n   */\r\n  tryGet(key, maxage, callback) {\r\n    const self = this;\r\n    if (!key) throw new Error('No Key Defined');\r\n    if (!callback) throw new Error('No Callback Defined');\r\n    if (!maxage) maxage = 10000;\r\n\r\n    const value = this._get(key);\r\n\r\n    const callbackResolver = function callbackResolver() {\r\n      return self.set(key, callback());\r\n    };\r\n\r\n    if (!value) {\r\n      return callbackResolver();\r\n    }\r\n    const milliOffset = Date.now() - new Date(value.stamp);\r\n\r\n    if (maxage < milliOffset) {\r\n      return callbackResolver();\r\n    }\r\n    return value.value;\r\n  }\r\n\r\n  /**\r\n   * Get cached value Async\r\n   * @param {string} key key string\r\n   * @param {integer} maxage in milliseconds\r\n   * @param {function/promise} callback function\r\n   * @returns {object} Promise\r\n   */\r\n  tryGetAsync(key, maxage, callback) {\r\n    const self = this;\r\n    if (!key) throw new Error('No Key Defined');\r\n    if (!callback) throw new Error('No Callback Defined');\r\n    if (!maxage) maxage = 10000;\r\n\r\n    const storageValue = this._get(key);\r\n\r\n    const callbackResolver = function callbackResolver() {\r\n      let callbackResult;\r\n      if (typeof callback === 'function') {\r\n        callbackResult = callback();\r\n      } else callbackResult = callback;\r\n\r\n      if (\r\n        callbackResult.toString() === '[object Promise]' ||\r\n        Object.prototype.hasOwnProperty.call(callbackResult, 'then')\r\n      ) {\r\n        return new Promise(function (resolve, reject) {\r\n          callbackResult\r\n            .then((result) => resolve(self.set(key, result)))\r\n            .catch((err) => reject(err));\r\n        });\r\n      }\r\n      return new Promise(function (resolve) {\r\n        resolve(self.set(key, callbackResult));\r\n      });\r\n    };\r\n\r\n    if (!storageValue || !storageValue.value) {\r\n      return callbackResolver();\r\n    }\r\n    const milliOffset = Date.now() - new Date(storageValue.stamp);\r\n\r\n    if (maxage < milliOffset) {\r\n      return callbackResolver();\r\n    }\r\n    return new Promise(function (resolve) {\r\n      resolve(storageValue.value);\r\n    });\r\n  }\r\n}\r\n"],"names":["LocalStorageJs","options","window","localStorage","Error","prefix","storage","value","stamp","Date","now","key","JSON","parse","getItem","_prepareKey","_get","removeItem","setItem","stringify","_prepareValue","i","length","startsWith","maxage","callback","self","callbackResolver","set","milliOffset","storageValue","callbackResult","toString","Object","prototype","hasOwnProperty","call","Promise","resolve","reject","then","result","err"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;;EACA;;EACA;;EACA;;EACA;MACqBA;EACnB,4BAA0B;EAAA,QAAdC,OAAc,uEAAJ,EAAI;;EAAA;;EACxB,QAAI,CAACC,MAAM,CAACC,YAAZ,EAA0B,MAAM,IAAIC,KAAJ,CAAU,gCAAV,CAAN;EAE1B,SAAKH,OAAL;EACEI,MAAAA,MAAM,EAAE;EADV,OAEKJ,OAFL;EAKA,SAAKK,OAAL,GAAeJ,MAAM,CAACC,YAAtB;EACD;;;;oCAEaI,OAAO;EACnB,aAAO;EACLC,QAAAA,KAAK,EAAEC,IAAI,CAACC,GAAL,EADF;EAELH,QAAAA,KAAK,EAALA;EAFK,OAAP;EAID;;;kCAEWI,KAAK;EACf,aAAO,KAAKV,OAAL,CAAaI,MAAb,GAAsBM,GAA7B;EACD;;;2BAEIA,KAAK;EACR,aAAOC,IAAI,CAACC,KAAL,CAAW,KAAKP,OAAL,CAAaQ,OAAb,CAAqB,KAAKC,WAAL,CAAiBJ,GAAjB,CAArB,CAAX,CAAP;EACD;;;0BAEGA,KAAK;EACP,UAAMJ,KAAK,GAAG,KAAKS,IAAL,CAAUL,GAAV,CAAd;;EACA,UAAIJ,KAAJ,EAAW,OAAOA,KAAK,CAACA,KAAb;EACX,aAAO,IAAP;EACD;;;0BAEGI,KAAKJ,OAAO;EACd,UAAI,CAACA,KAAL,EAAY,KAAKD,OAAL,CAAaW,UAAb,CAAwBN,GAAxB;EAEZ,WAAKL,OAAL,CAAaY,OAAb,CAAqB,KAAKH,WAAL,CAAiBJ,GAAjB,CAArB,EAA4CC,IAAI,CAACO,SAAL,CAAe,KAAKC,aAAL,CAAmBb,KAAnB,CAAf,CAA5C;EACA,aAAOA,KAAP;EACD;;;8BAEO;EACN,WAAK,IAAIc,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKf,OAAL,CAAagB,MAAjC,EAAyCD,CAAC,EAA1C,EAA8C;EAC5C,YAAMV,GAAG,GAAG,KAAKL,OAAL,CAAaK,GAAb,CAAiBU,CAAjB,CAAZ;EACA,YAAIV,GAAG,CAACY,UAAJ,CAAe,KAAKtB,OAAL,CAAaI,MAA5B,CAAJ,EAAyC,KAAKC,OAAL,CAAaW,UAAb,CAAwBN,GAAxB;EAC1C;EACF;EAED;;;;;;;;;;6BAOOA,KAAKa,QAAQC,UAAU;EAC5B,UAAMC,IAAI,GAAG,IAAb;EACA,UAAI,CAACf,GAAL,EAAU,MAAM,IAAIP,KAAJ,CAAU,gBAAV,CAAN;EACV,UAAI,CAACqB,QAAL,EAAe,MAAM,IAAIrB,KAAJ,CAAU,qBAAV,CAAN;EACf,UAAI,CAACoB,MAAL,EAAaA,MAAM,GAAG,KAAT;;EAEb,UAAMjB,KAAK,GAAG,KAAKS,IAAL,CAAUL,GAAV,CAAd;;EAEA,UAAMgB,gBAAgB,GAAG,SAASA,gBAAT,GAA4B;EACnD,eAAOD,IAAI,CAACE,GAAL,CAASjB,GAAT,EAAcc,QAAQ,EAAtB,CAAP;EACD,OAFD;;EAIA,UAAI,CAAClB,KAAL,EAAY;EACV,eAAOoB,gBAAgB,EAAvB;EACD;;EACD,UAAME,WAAW,GAAGpB,IAAI,CAACC,GAAL,KAAa,IAAID,IAAJ,CAASF,KAAK,CAACC,KAAf,CAAjC;;EAEA,UAAIgB,MAAM,GAAGK,WAAb,EAA0B;EACxB,eAAOF,gBAAgB,EAAvB;EACD;;EACD,aAAOpB,KAAK,CAACA,KAAb;EACD;EAED;;;;;;;;;;kCAOYI,KAAKa,QAAQC,UAAU;EACjC,UAAMC,IAAI,GAAG,IAAb;EACA,UAAI,CAACf,GAAL,EAAU,MAAM,IAAIP,KAAJ,CAAU,gBAAV,CAAN;EACV,UAAI,CAACqB,QAAL,EAAe,MAAM,IAAIrB,KAAJ,CAAU,qBAAV,CAAN;EACf,UAAI,CAACoB,MAAL,EAAaA,MAAM,GAAG,KAAT;;EAEb,UAAMM,YAAY,GAAG,KAAKd,IAAL,CAAUL,GAAV,CAArB;;EAEA,UAAMgB,gBAAgB,GAAG,SAASA,gBAAT,GAA4B;EACnD,YAAII,cAAJ;;EACA,YAAI,OAAON,QAAP,KAAoB,UAAxB,EAAoC;EAClCM,UAAAA,cAAc,GAAGN,QAAQ,EAAzB;EACD,SAFD,MAEOM,cAAc,GAAGN,QAAjB;;EAEP,YACEM,cAAc,CAACC,QAAf,OAA8B,kBAA9B,IACAC,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCL,cAArC,EAAqD,MAArD,CAFF,EAGE;EACA,iBAAO,IAAIM,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;EAC5CR,YAAAA,cAAc,CACXS,IADH,CACQ,UAACC,MAAD;EAAA,qBAAYH,OAAO,CAACZ,IAAI,CAACE,GAAL,CAASjB,GAAT,EAAc8B,MAAd,CAAD,CAAnB;EAAA,aADR,WAES,UAACC,GAAD;EAAA,qBAASH,MAAM,CAACG,GAAD,CAAf;EAAA,aAFT;EAGD,WAJM,CAAP;EAKD;;EACD,eAAO,IAAIL,OAAJ,CAAY,UAAUC,OAAV,EAAmB;EACpCA,UAAAA,OAAO,CAACZ,IAAI,CAACE,GAAL,CAASjB,GAAT,EAAcoB,cAAd,CAAD,CAAP;EACD,SAFM,CAAP;EAGD,OAnBD;;EAqBA,UAAI,CAACD,YAAD,IAAiB,CAACA,YAAY,CAACvB,KAAnC,EAA0C;EACxC,eAAOoB,gBAAgB,EAAvB;EACD;;EACD,UAAME,WAAW,GAAGpB,IAAI,CAACC,GAAL,KAAa,IAAID,IAAJ,CAASqB,YAAY,CAACtB,KAAtB,CAAjC;;EAEA,UAAIgB,MAAM,GAAGK,WAAb,EAA0B;EACxB,eAAOF,gBAAgB,EAAvB;EACD;;EACD,aAAO,IAAIU,OAAJ,CAAY,UAAUC,OAAV,EAAmB;EACpCA,QAAAA,OAAO,CAACR,YAAY,CAACvB,KAAd,CAAP;EACD,OAFM,CAAP;EAGD;;;;;;;;;;;;"}