{"version":3,"file":"LocalStorageAdapter.js","sources":["../src/LocalStorageAdapter.js"],"sourcesContent":["export default class LocalStorageJs {\r\n  constructor(prefix) {\r\n    if (!window.localStorage) throw \"No window.localStorage Defined\";\r\n\r\n    if (prefix) this._prefix = prefix;\r\n    else this._prefix = \"pre_\";\r\n\r\n    this._storage = window.localStorage;\r\n  }\r\n\r\n  _prepareValue(value) {\r\n    return { stamp: Date.now(), value: value };\r\n  }\r\n\r\n  _prepareKey(key) {\r\n    return this._prefix + key;\r\n  }\r\n\r\n  _get(key) {\r\n    return JSON.parse(this._storage.getItem(this._prepareKey(key)));\r\n  }\r\n\r\n  get(key) {\r\n    var value = this._get(key);\r\n    if (value) return value.value;\r\n    else return null;\r\n  }\r\n\r\n  set(key, value) {\r\n    if (!value) this._storage.removeItem(key);\r\n\r\n    this._storage.setItem(\r\n      this._prepareKey(key),\r\n      JSON.stringify(this._prepareValue(value))\r\n    );\r\n    return value;\r\n  }\r\n\r\n  clear() {\r\n    for (let i = 0; i < this._storage.length; i++) {\r\n      let key = this._storage.key(i);\r\n      if (key.startsWith(this._prefix)) this._storage.removeItem(key);\r\n    }\r\n  }\r\n  /**\r\n   * Get cached value\r\n   * @param {string} key\r\n   * @param {integer} maxage in milliseconds\r\n   * @param {function} callback\r\n   * @returns {object} value\r\n   */\r\n  tryGet(key, maxage, callback) {\r\n    var self = this;\r\n    if (!key) throw \"No Key Defined\";\r\n    if (!callback) throw \"No Callback Defined\";\r\n    if (!maxage) maxage = 10000;\r\n\r\n    var value = this._get(key);\r\n\r\n    var callbackResolver = function() {\r\n      return self.set(key, callback());\r\n    };\r\n\r\n    if (!value) {\r\n      return callbackResolver();\r\n    } else {\r\n      var milliOffset = Date.now() - new Date(value.stamp);\r\n\r\n      if (maxage < milliOffset) {\r\n        return callbackResolver();\r\n      } else return value.value;\r\n    }\r\n  }\r\n  /**\r\n   * Get cached value Async\r\n   * @param {string} key\r\n   * @param {integer} maxage in milliseconds\r\n   * @param {function/promise} callback\r\n   * @returns {object} Promise\r\n   */\r\n  tryGetAsync(key, maxage, callback) {\r\n    var self = this;\r\n    if (!key) throw \"No Key Defined\";\r\n    if (!callback) throw \"No Callback Defined\";\r\n    if (!maxage) maxage = 10000;\r\n\r\n    var storedValue = this._get(key);\r\n\r\n    var callbackResolver = function() {\r\n      var callbackResult;\r\n      if (typeof callback === \"function\") {\r\n        callbackResult = callback();\r\n      } else callbackResult = callback;\r\n\r\n      if (callbackResult.toString() === \"[object Promise]\"\r\n          || callbackResult.__proto__.hasOwnProperty('then')) {\r\n        return new Promise(function(resolve, reject) {\r\n          callbackResult.then(function(result) {\r\n            resolve(self.set(key, result));\r\n          });\r\n        });\r\n      } else {\r\n        return new Promise(function(resolve, reject) {\r\n          resolve(self.set(key, callbackResult));\r\n        });\r\n      }\r\n    };\r\n\r\n    if (!storedValue || !storedValue.value) {\r\n      return callbackResolver();\r\n    } else {\r\n      var milliOffset = Date.now() - new Date(storedValue.stamp);\r\n\r\n      if (maxage < milliOffset) {\r\n        return callbackResolver();\r\n      } else\r\n        return new Promise(function(resolve, reject) {\r\n          resolve(storedValue.value);\r\n        });\r\n    }\r\n  }\r\n}\r\n\r\n"],"names":["LocalStorageJs","prefix","window","localStorage","_prefix","_storage","value","stamp","Date","now","key","JSON","parse","getItem","_prepareKey","_get","removeItem","setItem","stringify","_prepareValue","i","length","startsWith","maxage","callback","self","callbackResolver","set","milliOffset","storedValue","callbackResult","toString","__proto__","hasOwnProperty","Promise","resolve","reject","then","result"],"mappings":"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"}