{"version":3,"file":"LocalStorageAdapter.js","sources":["../src/LocalStorageAdapter.js"],"sourcesContent":["export default class LocalStorageJs {\r\n  constructor(prefix) {\r\n    if (!window.localStorage) throw \"No window.localStorage Defined\";\r\n\r\n    if (prefix) this._prefix = prefix;\r\n    else this._prefix = \"pre_\";\r\n\r\n    this._storage = window.localStorage;\r\n  }\r\n\r\n  _prepareValue(value) {\r\n    return { stamp: Date.now(), value: value };\r\n  }\r\n\r\n  _prepareKey(key) {\r\n    return this._prefix + key;\r\n  }\r\n\r\n  _get(key) {\r\n    return JSON.parse(this._storage.getItem(this._prepareKey(key)));\r\n  }\r\n\r\n  get(key) {\r\n    var value = this._get(key);\r\n    if (value) return value.value;\r\n    else return null;\r\n  }\r\n\r\n  set(key, value) {\r\n    if (!value) this._storage.removeItem(key);\r\n\r\n    this._storage.setItem(\r\n      this._prepareKey(key),\r\n      JSON.stringify(this._prepareValue(value))\r\n    );\r\n    return value;\r\n  }\r\n\r\n  clear() {\r\n    for (let i = 0; i < this._storage.length; i++) {\r\n      let key = this._storage.key(i);\r\n      if (key.startsWith(this._prefix)) this._storage.removeItem(key);\r\n    }\r\n  }\r\n\r\n  tryGet(key, maxage, callback) {\r\n    var self = this;\r\n    if (!key) throw \"No Key Defined\";\r\n    if (!callback) throw \"No Callback Defined\";\r\n    if (!maxage) maxage = 10000;\r\n\r\n    if (typeof (callback) === \"function\") {\r\n      var value = this._get(key);\r\n      if (!value) {\r\n        return this.set(key, callback());\r\n      } else {\r\n        var milliOffset = Date.now() - new Date(value.stamp);\r\n        if (maxage < milliOffset) {\r\n          return this.set(key, callback());\r\n        } else return value.value;\r\n      }\r\n\r\n    } else if (typeof (callback) === \"object\"\r\n      && callback.toString() === \"[object Promise]\") {\r\n\r\n      return new Promise((resolve, reject) => {\r\n\r\n        var value = this._get(key);\r\n        if (!value) {\r\n          promise.then((result) => {\r\n            resolve(self.set(key, result));\r\n          });\r\n        } else {\r\n          var milliOffset = Date.now() - new Date(value.stamp);\r\n          if (maxage < milliOffset) {\r\n            promise.then((result) => {\r\n              resolve(self.set(key, result));\r\n            });\r\n          }\r\n          else resolve(value.value);\r\n        }\r\n      });\r\n\r\n    }\r\n\r\n  }\r\n}\r\n"],"names":["LocalStorageJs","prefix","window","localStorage","_prefix","_storage","value","stamp","Date","now","key","JSON","parse","getItem","_prepareKey","_get","removeItem","setItem","stringify","_prepareValue","i","length","startsWith","maxage","callback","self","set","milliOffset","toString","Promise","resolve","reject","promise","then","result"],"mappings":"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"}