{"version":3,"file":"LocalStorageAdapter.js","sources":["../src/LocalStorageAdapter.js"],"sourcesContent":["export default class LocalStorageJs {\r\n    constructor(prefix) {\r\n        if (!window.localStorage) throw \"No window.localStorage Defined\";\r\n\r\n        if (prefix) this._prefix = prefix;\r\n        else this._prefix = \"pre_\";\r\n\r\n        this._storage = window.localStorage;\r\n    }\r\n\r\n    _prepareValue(value) {\r\n        return { stamp: Date.now(), value: value };\r\n    }\r\n\r\n    _prepareKey(key) {\r\n        return this._prefix + key;\r\n    }\r\n\r\n    _get(key) {\r\n        return JSON.parse(this._storage.getItem(this._prepareKey(key)));\r\n    }\r\n\r\n    get(key) {\r\n        var value = this._get(key);\r\n        if (value) return value.value;\r\n        else return null;\r\n    }\r\n\r\n    set(key, value) {\r\n        if (!value) this._storage.removeItem(key);\r\n\r\n        this._storage.setItem(\r\n            this._prepareKey(key),\r\n            JSON.stringify(this._prepareValue(value))\r\n        );\r\n        return value;\r\n    }\r\n\r\n    clear() {\r\n        for (let i = 0; i < this._storage.length; i++) {\r\n            let key = this._storage.key(i);\r\n            if (key.startsWith(this._prefix)) this._storage.removeItem(key);\r\n        }\r\n    }\r\n    /**\r\n     * Get cached value\r\n     * @param {string} key key string\r\n     * @param {integer} maxage in milliseconds\r\n     * @param {function} callback function\r\n     * @returns {object} value\r\n     */\r\n    tryGet(key, maxage, callback) {\r\n        var self = this;\r\n        if (!key) throw \"No Key Defined\";\r\n        if (!callback) throw \"No Callback Defined\";\r\n        if (!maxage) maxage = 10000;\r\n\r\n        var value = this._get(key);\r\n\r\n        var callbackResolver = function () {\r\n            return self.set(key, callback());\r\n        };\r\n\r\n        if (!value) {\r\n            return callbackResolver();\r\n        } else {\r\n            var milliOffset = Date.now() - new Date(value.stamp);\r\n\r\n            if (maxage < milliOffset) {\r\n                return callbackResolver();\r\n            } else return value.value;\r\n        }\r\n    }\r\n    /**\r\n     * Get cached value Async\r\n     * @param {string} key key string\r\n     * @param {integer} maxage in milliseconds\r\n     * @param {function/promise} callback function\r\n     * @returns {object} Promise\r\n     */\r\n    tryGetAsync(key, maxage, callback) {\r\n        var self = this;\r\n        if (!key) throw \"No Key Defined\";\r\n        if (!callback) throw \"No Callback Defined\";\r\n        if (!maxage) maxage = 10000;\r\n\r\n        var storageValue = this._get(key);\r\n\r\n        var callbackResolver = function () {\r\n            var callbackResult;\r\n            if (typeof callback === \"function\") {\r\n                callbackResult = callback();\r\n            } else callbackResult = callback;\r\n\r\n            if (callbackResult.toString() === \"[object Promise]\"\r\n                || callbackResult.__proto__.hasOwnProperty('then')) {\r\n                return new Promise(function (resolve, reject) {\r\n                    callbackResult\r\n                        .then(result => resolve(self.set(key, result)))\r\n                        .catch(err => reject(err));\r\n                });\r\n            } else {\r\n                return new Promise(function (resolve, reject) {\r\n                    resolve(self.set(key, callbackResult));\r\n                });\r\n            }\r\n        };\r\n\r\n        if (!storageValue || !storageValue.value) {\r\n            return callbackResolver();\r\n        } else {\r\n            var milliOffset = Date.now() - new Date(storageValue.stamp);\r\n\r\n            if (maxage < milliOffset) {\r\n                return callbackResolver();\r\n            } else\r\n                return new Promise(function (resolve, reject) {\r\n                    resolve(storageValue.value);\r\n                });\r\n        }\r\n    }\r\n}\r\n"],"names":["LocalStorageJs","prefix","window","localStorage","_prefix","_storage","value","stamp","Date","now","key","JSON","parse","getItem","_prepareKey","_get","removeItem","setItem","stringify","_prepareValue","i","length","startsWith","maxage","callback","self","callbackResolver","set","milliOffset","storageValue","callbackResult","toString","__proto__","hasOwnProperty","Promise","resolve","reject","then","result","err"],"mappings":"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"}